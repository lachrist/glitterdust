<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <script src="http://cdnjs.cloudflare.com/ajax/libs/ace/1.2.0/ace.js"></script>
    <style>#main-div {
  font-family: Helvetica, 'Open Sans', Arial, sans-serif;
  font-weight: lighter;
  width: 1000px;
  margin: auto;
}
.code {
  font-family: "Lucida Console", Monaco, monospace;
  font-size: 12px;
}
h1 {
  text-align: center;
}
p {
  text-align: justify;
}
label {
  display: block;
  height: 20px;
}
#output-div label {
  margin: 10px;
}
textarea {
  margin-top: 5px;
  margin-bottom: 5px;
}
button {
  padding: 8px;
  margin-bottom: 30px;
  font-size: 14px
}
button::-moz-focus-inner {
  padding: 8px;
}
.editor {
  resize: both;
  overflow: auto;
  width: 480px;
  height: 200px;
  margin-top: 10px;
  margin-bottom: 10px;
  margin-right: 10px;
  border: 1px #C0C0C0 solid;
}
#master-div, #target-div, #instrumented-div, #output-div {
  display: inline-block;
  vertical-align: top;
}
#output-div {
  vertical-align: bottom;
}</style>
    <script>require=(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){

// node ../run.js --mode batch --out ./batch.html --instrument ./multiply.js --masters ./masters --targets ./targets --help

module.exports = function (master, target) { return Array(Number(master)+1).join(target) }

},{}],2:[function(require,module,exports){

exports.round = function (x) { return Math.round(1000*x)/1000 }

exports.print = function (x) { return (typeof x === "string") ? JSON.stringify(x) : String(x) }

exports.benchmark = function (code) {
  var out = {};
  out.loc = code.split("\n").length;
  out.time = performance.now();
  try { out.result = window.eval(code) }
  catch (e) { out.error = e }
  out.time = performance.now()-out.time;
  return out;
}

},{}],"glitterdust":[function(require,module,exports){

var Instrument = require("/Users/soft/Desktop/workspace/glitterdust/test/multiply.js");
var Util = require("../util.js");

var editors = {};
function editor (name) {
  var editor = ace.edit(name+"-editor");
  editor.setTheme("ace/theme/chrome");
  editor.getSession().setMode("ace/mode/javascript");
  editor.$blockScrolling = Infinity;
  editor.setOption("showPrintMargin", false);
  editor.getSession().setTabSize(2);
  editor.getSession().setUseSoftTabs(true);
  editors[name] = editor;
}

function select (select, object, editor) {
  var first = null;
  for (var name in object) {
    first = first || name;
    var option = document.createElement("option");
    option.textContent = name;
    option.value = name;
    select.appendChild(option);
  }
  if (!first)
    return select.visibility = "hidden";
  select.onchange = function () { editor.setValue(object[select.value], -1) };
  select.value = ("Default" in object) ? "Default" : first;
  select.onchange();
}

module.exports = function () {
  ["master", "target", "instrumented"].forEach(editor);
  editors.instrumented.setReadOnly(true);
  select(document.getElementById("master-select"), {"x0.txt":"0","x1.txt":"1","x2.txt":"2","x3.txt":"3"}, editors.master);
  select(document.getElementById("target-select"), {"fac.js":"\nfunction fac (n) { return n ? n*fac(n-1) : 1 }\nfac(150);\n","fibo.js":"\nfunction fibo (n) { return n<=1 ? n : fibo(n-1)+fibo(n-2) }\nfibo(40);\n"}, editors.target);
  document.getElementById("run-button").onclick = function () {
    try {
      var instrumented = Instrument(editors.master.getValue(), editors.target.getValue());
    } catch (e) {
      alert("Error during instrumentation: "+e);
      throw e;
    }
    editors.instrumented.setValue(instrumented, -1);
    var out1 = Util.benchmark(editors.target.getValue());
    var out2 = Util.benchmark(instrumented);
    document.getElementById("result-span").textContent = Util.print(out1.result);
    document.getElementById("error-span").textContent = Util.print(out1.error);
    document.getElementById("time-span").textContent = Util.round(out1.time)+"ms";
    document.getElementById("instrumented-result-span").textContent = Util.print(out2.result);
    document.getElementById("instrumented-error-span").textContent = Util.print(out2.error);
    document.getElementById("instrumented-time-span").textContent = Util.round(out2.time)+"ms";
    if (out1.error)
      console.dir(out1.error);
    if (out2.error)
      console.dir(out2.error);
  };
};

},{"../util.js":2,"/Users/soft/Desktop/workspace/glitterdust/test/multiply.js":1}]},{},[]);

window.onload = require('glitterdust');</script>
  </head>
  <body>
    <div id="main-div">
      <div id="target-div">
        <label>Target: <select id="target-select"></select></label></label>
        <div class="editor" id="target-editor"></div>
        <button id="run-button">Run</button>
      </div>
      <div id="master-div">
        <label>Master: <select id="master-select"></select></label>
        <div class="editor" id="master-editor"></div>
      </div>
      <div id="instrumented-div">
        <label>Instrumented:</label>
        <div class="editor" id="instrumented-editor"></div>
      </div>
      <div id="output-div">
        <label>Original result: <span id="result-span" class="code"></span></label>
        <label>Original error: <span id="error-span" class="code"></span></label>
        <label>Original time: <span id="time-span" class="code"></span></label>
        <label>Instrumented result: <span id="instrumented-result-span" class="code"></span></label>
        <label>Instrumented error: <span id="instrumented-error-span" class="code"></span></label>
        <label>Instrumented time: <span id="instrumented-time-span" class="code"></span></label>
      </div>
    </div>
  </body>
</html>